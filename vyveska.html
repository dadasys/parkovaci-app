<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Přehled rezervací</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root{ --scale:1; }
    /* škálování celé tabule, aby se na výšku vešla beze změny layoutu */
    .scale-wrap{
      transform: scale(var(--scale));
      transform-origin: top center;
      /* šířku „vrátíme“ zpět, aby se po scale vešlo na viewport */
      width: calc(100% / var(--scale));
    }
    /* breakpoints – jen měníme scale, layout zůstává stejný */
    @media (max-width: 1024px){ :root{ --scale: .9; } }
    @media (max-width: 900px) { :root{ --scale: .85; } }
    @media (max-width: 768px) { :root{ --scale: .8; } }
    @media (max-width: 640px) { :root{ --scale: .72; } }
    @media (max-width: 480px) { :root{ --scale: .65; } }

    body{
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background:#f3f4f6; margin:0;
    }
    header{
      background:#2563eb; color:#fff; padding:14px 16px;
      display:flex; flex-wrap:wrap; justify-content:space-between; align-items:center;
    }
    header h1{ margin:0 auto; font-size:20px; font-weight:700; }
    .header-buttons{ display:flex; gap:10px; }
    .header-buttons a{
      background:#fff; color:#2563eb; text-decoration:none; padding:8px 14px;
      border-radius:8px; font-weight:600;
    }
    .header-buttons a:hover{ background:#e0e7ff; }

    .weekbar{
      display:flex; justify-content:center; align-items:center; gap:10px; margin:14px 0;
    }
    .weekbar button{
      background:#2563eb; color:#fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer;
    }
    .weekbar strong{ color:#111827; }

    /* DESKTOP layout – přesně 5 sloupců jako teď */
    .board{
      margin:0 auto; padding:0 12px 24px;
      display:grid; grid-template-columns: repeat(5, 220px);
      gap:14px; width:max-content;
    }

    .day{
      background:#fff; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,.08);
      padding:10px; width:220px;
    }
    .day h3{
      margin:0 0 8px; text-align:center; color:#1e3a8a; font-size:16px; line-height:1.2;
    }
    .slot{ margin-top:8px; }
    .slot .cap{
      text-align:center; color:#1e3a8a; font-weight:700; margin-bottom:6px; font-size:13px;
    }

    .place{
      border:1px solid #e5e7eb; border-radius:8px; padding:6px 8px; margin:6px 0;
      display:flex; align-items:center; justify-content:center; height:36px;
      background:#fff; font-size:13px;
    }
    .place .num{ font-weight:700; margin-right:6px; }

    .volno{ background:#bbf7d0; }          /* zelené volno */
    .prio{ background:#fde047; }           /* tmavší žlutá – prioritní */
    .npr  { background:#fef9c3; }          /* světlejší žlutá – neprioritní */
  </style>
</head>
<body>
  <header>
    <div style="width:110px"></div>
    <h1>Přehled rezervací</h1>
    <div class="header-buttons">
      <a href="index.html">Přejít do aplikace</a>
      <a href="pravidla.html">Pravidla</a>
    </div>
  </header>

  <div class="scale-wrap">
    <div class="weekbar">
      <button id="prevWeek">◀️ Předchozí týden</button>
      <strong id="weekRange"></strong>
      <button id="nextWeek">Následující týden ▶️</button>
    </div>

    <div class="board" id="board">Načítám…</div>
  </div>

  <script>
    // === Supabase ===
    const supabaseUrl = "https://cndtzwoioigzninoslbs.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNuZHR6d29pb2lnem5pbm9zbGJzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5OTMyODAsImV4cCI6MjA3NDU2OTI4MH0.aGHIGpSW3HZCcEZnIlAr8gmlc-fOWHs2dSXuINxn5x0";
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    const days = ["Pondělí","Úterý","Středa","Čtvrtek","Pátek"];
    const times = ["7-13","13-00"];
    const places = [1,2,3,4,5,6];

    let weekOffset = 0;

    function getWeekDates(ofs=0){
      const d = new Date();
      const day = d.getDay();
      const diff = d.getDate() - day + (day===0?-6:1) + ofs*7; // pondělí
      const mon = new Date(d.setDate(diff));
      return Array.from({length:5}, (_,i)=>{ const x=new Date(mon); x.setDate(mon.getDate()+i); return x; });
    }
    function fmtDateISO(dt){ return dt.toISOString().split("T")[0]; }
    function setWeekLabel(){
      const w = getWeekDates(weekOffset);
      weekRange.textContent = `${w[0].toLocaleDateString("cs-CZ")} - ${w[4].toLocaleDateString("cs-CZ")}`;
    }

    async function load(){
      const board = document.getElementById("board");
      board.textContent = "Načítám…";
      const [{data:res=[]},{data:users=[]}] = await Promise.all([
        supabase.from("reservations").select("*"),
        supabase.from("users").select("*")
      ]);

      const week = getWeekDates(weekOffset);
      board.innerHTML = "";

      days.forEach((dayName, i)=>{
        const dateISO = fmtDateISO(week[i]);

        const day = document.createElement("div");
        day.className = "day";
        day.innerHTML = `<h3>${dayName}<br>${week[i].toLocaleDateString("cs-CZ")}</h3>`;

        times.forEach(t=>{
          const slot = document.createElement("div");
          slot.className = "slot";
          slot.innerHTML = `<div class="cap">${t}</div>`;

          places.forEach(p=>{
            const r = res.find(r=> r.place===p && r.date===dateISO && r.time_slot===t);
            const div = document.createElement("div");
            div.className = "place";
            div.innerHTML = `<span class="num">${p}</span>`;

            if(r){
              const u = users.find(u=> u.id===r.userId);
              div.classList.add(u?.priority ? "prio" : "npr");
              div.innerHTML += `${u?.name || u?.username || "?"} ${u?.spz?`(${u.spz})`:""}${u?.priority?" prioritní":""}`;
            }else{
              div.classList.add("volno");
              div.innerHTML += `Volno`;
            }
            slot.appendChild(div);
          });

          day.appendChild(slot);
        });

        board.appendChild(day);
      });
    }

    prevWeek.onclick = ()=>{ weekOffset--; setWeekLabel(); load(); };
    nextWeek.onclick = ()=>{ weekOffset++; setWeekLabel(); load(); };
    setWeekLabel(); load();
  </script>
</body>
</html>
